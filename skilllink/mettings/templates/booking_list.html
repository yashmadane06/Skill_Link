{% extends 'base.html' %}
{% block title %}My Bookings - SkillLink{% endblock %}

{% block content %}
<div class="container mt-5 max-w-4xl">

  <h1 class="text-center mb-5 fw-bold text-dark animate__animated animate__fadeInDown">My Bookings</h1>

  {# --- Incoming Bookings (Provider) --- #}
  <h2 class="text-dark fw-semibold mb-3 animate__animated animate__fadeInLeft">Incoming Booking Requests</h2>
  {% for booking in bookings_received %}
  <div class="card shadow mb-4 animate__animated animate__fadeInUp" 
       style="border:2px solid #F0E68C; background-color:#FFF8DC; transition: transform 0.3s ease;">
    <div class="card-body">
      <p><strong>Skill:</strong> {{ booking.skill.name }}</p>
      <p><strong>Status:</strong> <span class="badge bg-info text-dark">{{ booking.status|capfirst }}</span></p>
      <p><strong>Requester:</strong> {{ booking.requester.user.get_full_name|default:booking.requester.user.username }}</p>

      <p><strong>Proposed Times:</strong></p>
      <ul>
        {% for h in booking.history.all %}
        <li>{{ h.proposed_time|date:"D, d M Y H:i" }}</li>
        {% endfor %}
      </ul>

      <div class="d-flex flex-wrap gap-2 mt-2">
        {% if booking.status == 'pending' %}
          <a href="{% url 'schedule_meeting' booking.id %}" class="btn btn-success fw-bold shadow-sm">Accept & Schedule</a>
          <a href="{% url 'booking_update_status' booking.id 'reject' %}" class="btn btn-danger fw-bold shadow-sm">Reject</a>
        {% elif booking.status == 'scheduled' %}
          {% if booking.provider.user == user %}
            <a href="{% url 'start_meeting' booking.id %}" target="_blank" class="btn btn-primary fw-bold shadow-sm">Start Zoom</a>
          {% elif booking.requester.user == user %}
            {% if booking.meeting_started %}
              <a href="{{ booking.meeting_link }}" target="_blank" class="btn btn-success fw-bold shadow-sm">Join Zoom</a>
            {% else %}
              <p class="text-dark fw-semibold">Waiting for host to start the meeting...</p>
            {% endif %}
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>
  {% empty %}
  <p class="text-dark mb-4">No incoming bookings.</p>
  {% endfor %}

  {# --- My Bookings (Requester) --- #}
  <h2 class="text-dark fw-semibold mb-3 mt-5 animate__animated animate__fadeInLeft">My Bookings (Requested)</h2>
  {% for booking in bookings_made %}
  <div class="card shadow mb-4 animate__animated animate__fadeInUp" 
       style="border:2px solid #F0E68C; background-color:#FFF8DC; transition: transform 0.3s ease;">
    <div class="card-body">
      <p><strong>Skill:</strong> {{ booking.skill.name }}</p>
      <p><strong>Status:</strong> <span class="badge bg-info text-dark">{{ booking.status|capfirst }}</span></p>
      <p><strong>Provider:</strong> {{ booking.provider.user.get_full_name|default:booking.provider.user.username }}</p>

      <p><strong>Proposed Times:</strong></p>
      <ul>
        {% for h in booking.history.all %}
        <li>{{ h.proposed_time|date:"D, d M Y H:i" }}</li>
        {% endfor %}
      </ul>

      <div class="d-flex flex-wrap gap-2 mt-2">
        {% if booking.status == 'pending' %}
          <a href="{% url 'booking_update_status' booking.id 'cancel' %}" class="btn btn-warning fw-bold shadow-sm">Cancel</a>
        {% elif booking.status == 'scheduled' %}
          {% if booking.requester.user == user %}
            {% if booking.meeting_started %}
              <a href="{{ booking.meeting_link }}" target="_blank" class="btn btn-success fw-bold shadow-sm">Join Zoom</a>
            {% else %}
              <p class="text-dark fw-semibold">Waiting for host to start the meeting...</p>
            {% endif %}
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>
  {% empty %}
  <p class="text-dark">No bookings made yet.</p>
  {% endfor %}

</div>

<style>
.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.btn {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.btn:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}
.badge {
    font-size: 0.85rem;
    border-radius: 12px;
    padding: 0.35em 0.7em;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.badge:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.animate__animated { --animate-duration: 0.8s; }
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
{% endblock %}
